{% extends "../partials/layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set pageTitle = prisonerName | possessiveName + " non-associations" %}

{% block content %}

  <span class="govuk-caption-l">Non-associations</span>
  <h1 class="govuk-heading-l">
    {{ prisonerName | possessiveName}} non-associations
  </h1>
  <p class="govuk-!-text-align-right">
    {{ govukButton({
      text: "Add new non-association",
      element: "a",
      href: routeUrls.prisonerSearch(prisonerNumber)
    }) }}
  </p>

  {% set tableRows = [] %}
  {% for nonAssociation in nonAssociationsList.nonAssociations %}
    {% set otherPrisonerPhoto %}
      <img src="{{ routeUrls.prisonerPhoto(nonAssociation.otherPrisonerDetails.prisonerNumber) }}" alt="Photo of {{ nonAssociation.otherPrisonerDetails | nameOfPrisoner }}" class="app-prisoner-photo" />
    {% endset %}

    {% set otherPrisonerProfileLink %}
      <a href="{{ dpsUrl }}/prisoner/{{ nonAssociation.otherPrisonerDetails.prisonerNumber }}">
        <span class="govuk-visually-hidden"> View prisoner profile for </span>
        {{ nonAssociation.otherPrisonerDetails | reversedNameOfPrisoner }}
        <br />
        {{ nonAssociation.otherPrisonerDetails.prisonerNumber }}
      </a>
    {% endset %}

    {% set reason %}
      {{ nonAssociation.reasonDescription }}
    {% endset %}

    {% set role %}
      {{ nonAssociation.otherPrisonerDetails.roleDescription }}
    {% endset %}

    {% set restrictionType %}
      {{ nonAssociation.restrictionTypeDescription }}
    {% endset %}

    {% set comment %}
      {{ nonAssociation.comment }}
    {% endset %}

    {% set firstCreated %}
      {{ nonAssociation.whenCreated | date }}
      <br />
      by
      {{ nonAssociation.authorisedBy }}
    {% endset %}

    {% set lastUpdated %}
      {{ nonAssociation.whenUpdated | date }}
      <br />
      by ???
    {% endset %}

    {% set tableRows = (tableRows.push([
      {html: otherPrisonerPhoto},
      {html: otherPrisonerProfileLink},
      {html: reason},
      {html: role},
      {html: restrictionType},
      {html: comment},
      {html: firstCreated}
    ]), tableRows) %}
  {% endfor %}

  {% set caption -%}
    Non-associations for {{ prisonerName }}
  {%- endset %}

  {% if tableRows.length > 0 %}

    <div class="app-sortable-table-container">
      {{ govukTable({
        caption: caption,
        captionClasses: "govuk-visually-hidden",
        classes: "app-sortable-table",
        head: [
          {text: ""},
          {text: "Name"},
          {text: "Reason"},
          {text: "Role"},
          {text: "Where to keep apart"},
          {text: "Comments"},
          {text: "Date added"}
        ],
        rows: tableRows
      }) }}
    </div>

  {% else %}

    <p>
      This prisoner has no open non-associations in {{ prisonName }}.
    </p>

  {% endif %}

{% endblock %}
