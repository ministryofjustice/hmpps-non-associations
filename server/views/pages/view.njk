{% extends "../partials/layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set pageTitle = prisonerName | possessiveName + " non-associations" %}

{% block content %}

  {% include "../partials/messages.njk" %}

  <span class="govuk-caption-l">Non-associations</span>
  <h1 class="govuk-heading-l">
    {{ prisonerName | possessiveName}} non-associations
  </h1>
  <p class="govuk-!-text-align-right">
    {{ govukButton({
      text: "Add new non-association",
      classes: "app-button--blue",
      element: "a",
      href: routeUrls.prisonerSearch(prisonerNumber)
    }) }}
  </p>

  {% set tableRows = [] %}
  {% for nonAssociation in nonAssociationsList.nonAssociations %}
    {% set otherPrisonerPhoto %}
      <img src="{{ routeUrls.prisonerPhoto(nonAssociation.otherPrisonerDetails.prisonerNumber) }}" alt="Photo of {{ nonAssociation.otherPrisonerDetails | nameOfPerson }}" class="app-prisoner-photo" />
    {% endset %}

    {% set otherPrisonerProfileLink %}
      <a href="{{ dpsUrl }}/prisoner/{{ nonAssociation.otherPrisonerDetails.prisonerNumber }}">
        <span class="govuk-visually-hidden"> View prisoner profile for </span>
        {{ nonAssociation.otherPrisonerDetails | reversedNameOfPerson }}
        <br />
        {{ nonAssociation.otherPrisonerDetails.prisonerNumber }}
      </a>
      <br />
      {{ nonAssociation.otherPrisonerDetails.cellLocation }}
    {% endset %}

    {% set reason %}
      {{ nonAssociation.reasonDescription }}
    {% endset %}

    {% set role %}
      {{ nonAssociation.otherPrisonerDetails.roleDescription }}
    {% endset %}

    {% set restrictionType %}
      {{ nonAssociation.restrictionTypeDescription }}
    {% endset %}

    {% set comment %}
      {{ nonAssociation.comment }}
    {% endset %}

    {% set firstCreated %}
      {{ nonAssociation.whenCreated | date }}
      <br />
      by {{ nonAssociation.authorisedBy }}
    {% endset %}

    {% set lastUpdated %}
      {{ nonAssociation.whenUpdated | date }}
      <br />
      by ???
    {% endset %}

    {% set tableRows = (tableRows.push([
      {html: otherPrisonerPhoto, classes: "app-view__cell--photo"},
      {html: otherPrisonerProfileLink, classes: "app-view__cell--prisoner"},
      {html: reason, classes: "app-view__cell--reason"},
      {html: role, classes: "app-view__cell--role"},
      {html: restrictionType, classes: "app-view__cell--restriction-type"},
      {html: comment, classes: "app-view__cell--comment"},
      {html: firstCreated, classes: "app-view__cell--date-added"}
    ]), tableRows) %}
  {% endfor %}

  {% set caption -%}
    Non-associations for {{ prisonerName }}
  {%- endset %}

  {% if tableRows.length > 0 %}

    <div class="app-sortable-table-container">
      {{ govukTable({
        caption: caption,
        captionClasses: "govuk-visually-hidden",
        classes: "app-sortable-table",
        head: [
          {text: "", classes: "app-view__cell--photo"},
          {text: "Prisoner", classes: "app-view__cell--prisoner"},
          {text: "Reason", classes: "app-view__cell--reason"},
          {text: "Role", classes: "app-view__cell--role"},
          {text: "Where to keep apart", classes: "app-view__cell--restriction-type"},
          {text: "Comments", classes: "app-view__cell--comment"},
          {text: "Date added", classes: "app-view__cell--date-added"}
        ],
        rows: tableRows
      }) }}
    </div>

  {% else %}

    <p>
      This prisoner has no open non-associations in {{ prisonName }}.
    </p>

  {% endif %}

{% endblock %}
