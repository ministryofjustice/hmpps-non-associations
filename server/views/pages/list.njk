{% extends "../partials/layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}

{% from "../partials/keyPrisonerDetails.njk" import keyPrisonerDetails %}
{% from "../partials/nonAssociationGroup.njk" import nonAssociationGroup %}

{% macro displayCount(number) %}
  {%- if number == 1 -%}
    1 record
  {%- else -%}
    {{ number }} records
  {%- endif -%}
{% endmacro %}

{% set pageTitle = prisonerName | possessiveName + " non-associations" %}

{% block content %}

  {% include "../partials/messages.njk" %}
  {% include "../partials/formErrorSummary.njk" %}

  <h1 class="govuk-heading-l">
    {{ prisonerName | possessiveName}} non-associations
  </h1>

  {% call keyPrisonerDetails(routeUrls, prisoner) %}
    {% if not prisoner | isOutside %}
      <div class="app-key-prisoner-details--align-right">
        <p class="hmpps-action-button">
          <img src="/assets/images/add-non-association.svg" alt="Icon representing a non-association" aria-hidden="true" />
          <a href="{{ routeUrls.prisonerSearch(prisonerNumber) }}" class="govuk-link--no-visited-state">
            Add new non-association
          </a>
        </p>
      </div>
    {% endif %}
  {% endcall %}

  <nav class="govuk-!-margin-top-6 govuk-!-margin-bottom-6">
    <ul class="govuk-tabs__list">
      <li class="govuk-tabs__list-item {% if listing === "open" %}govuk-tabs__list-item--selected{% endif %}">
        <a class="govuk-tabs__tab" href="{{ routeUrls.list(prisonerNumber) }}">
          Open ({{ displayCount(nonAssociationsList.openCount) }})
        </a>
      </li>
      <li class="govuk-tabs__list-item {% if listing === "closed" %}govuk-tabs__list-item--selected{% endif %}">
        <a class="govuk-tabs__tab" href="{{ routeUrls.list(prisonerNumber, true) }}">
          Closed ({{ displayCount(nonAssociationsList.closedCount) }})
        </a>
      </li>
    </ul>
  </nav>

  {% if nonAssociationGroups.type == "noGroups" %}

    <p>
      {% if listing == "closed" %}
        {{ prisonerName }} has no closed non-associations.
      {% else %}
        {{ prisonerName }} has no open non-associations.
      {% endif %}
    </p>

  {% elif nonAssociationGroups.type == "threeGroups" %}

    {% set emptyMessageHtml %}
      {% if listing == "closed" %}
        {{ prisonerName }} has no closed non-associations in {{ prisoner.prisonName }}.
      {% else %}
        {{ prisonerName }} has no open non-associations in {{ prisoner.prisonName }}.
      {% endif %}
    {% endset %}
    {{ nonAssociationGroup(
      routeUrls,
      'same',
      tableHeads.same,
      prisoner,
      nonAssociationGroups.samePrison,
      listing,
      emptyMessageHtml
    ) }}

    {% set emptyMessageHtml %}
      {% if listing == "closed" %}
        {{ prisonerName }} has no closed non-associations in other establishments.
      {% else %}
        {{ prisonerName }} has no open non-associations in other establishments.
      {% endif %}
    {% endset %}
    {{ nonAssociationGroup(
      routeUrls,
      'other',
      tableHeads.other,
      prisoner,
      nonAssociationGroups.otherPrisons,
      listing,
      emptyMessageHtml
    ) }}

    {% set emptyMessageHtml %}
      {% if listing == "closed" %}
        {{ prisonerName }} has no closed non-associations outside an establishment.
      {% else %}
        {{ prisonerName }} has no open non-associations outside an establishment.
      {% endif %}
    {% endset %}
    {{ nonAssociationGroup(
      routeUrls,
      'outside',
      tableHeads.outside,
      prisoner,
      nonAssociationGroups.transferOrOutside,
      listing,
      emptyMessageHtml
    ) }}

  {% elif nonAssociationGroups.type == "twoGroups" %}

    {% set emptyMessageHtml %}
      {% if listing == "closed" %}
        {{ prisonerName }} has no closed non-associations in an establishment.
      {% else %}
        {{ prisonerName }} has no open non-associations in an establishment.
      {% endif %}
    {% endset %}
    {{ nonAssociationGroup(
      routeUrls,
      'any',
      tableHeads.any,
      prisoner,
      nonAssociationGroups.anyPrison,
      listing,
      emptyMessageHtml
    ) }}

    {% set emptyMessageHtml %}
      {% if listing == "closed" %}
        {{ prisonerName }} has no closed non-associations outside an establishment.
      {% else %}
        {{ prisonerName }} has no open non-associations outside an establishment.
      {% endif %}
    {% endset %}
    {{ nonAssociationGroup(
      routeUrls,
      'outside',
      tableHeads.outside,
      prisoner,
      nonAssociationGroups.transferOrOutside,
      listing,
      emptyMessageHtml
    ) }}

  {% endif %}

{% endblock %}
